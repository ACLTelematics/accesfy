# ğŸ§© ACCESFY Backend (SaaS para gimnasios)

Plataforma SaaS diseÃ±ada para gestionar mÃºltiples gimnasios de forma independiente, con control de usuarios, membresÃ­as, asistencia, staff, y backups automÃ¡ticos.

---

## ğŸš€ TecnologÃ­as Principales
-âš™ï¸ TecnologÃ­as Principales

Lenguaje Backend: PHP 8.3+
Framework: Laravel 11
Base de Datos: PostgreSQL 16
AutenticaciÃ³n: Laravel Sanctum / Passport
Infraestructura: Hetzner (Servidor) + Namecheap (Dominio)
Versionado: GitHub
Contenedores: Docker (opcional) 

## ğŸ§± Arquitectura General
+---------------------+       +-------------------+       +----------------------+
|   Frontend (React)  | <---> |  API Laravel REST | <---> |  PostgreSQL Database |
|  (Accesfy Web App)  |       |  (Backend Server) |       |  (Usuarios, Gyms)    |
+---------------------+       +-------------------+       +----------------------+


## ğŸ‘¥ Roles del Sistema

| Rol | DescripciÃ³n | Permisos principales |
|------|--------------|---------------------|
| **Admin SaaS** | Superadministrador global | Crear, suspender gimnasios, manejar backups globales |
| **DueÃ±o de Gimnasio** | Propietario del gimnasio | CRUD de miembros, staff, membresÃ­as, backups locales |
| **Staff** | Empleado del gimnasio | Check-in/out de clientes, no puede restaurar backups |
| **Miembro** | Cliente del gimnasio | Consultar su membresÃ­a, historial de asistencia |

### ğŸ”¹ Tabla `users`

| Campo | Tipo | DescripciÃ³n |
|--------|------|-------------|
| id | BIGINT (PK) | Identificador Ãºnico |
| name | VARCHAR(100) | Nombre completo |
| email | VARCHAR(150) | Correo (Ãºnico) |
| password | VARCHAR(255) | ContraseÃ±a cifrada |
| role | ENUM('admin','owner','staff','member') | Rol del usuario |
| gym_id | BIGINT (FK, nullable) | Vinculado al gimnasio (solo si no es admin global) |
| active | BOOLEAN | Estado del usuario |
| created_at / updated_at | TIMESTAMP | AuditorÃ­a |

> ğŸ”¸ El campo `gym_id` es `NULL` para el **Admin SaaS**, y apunta al gimnasio correspondiente para dueÃ±os, staff o miembros.

---

### ğŸ”¹ Tabla `gyms`

| Campo | Tipo | DescripciÃ³n |
|--------|------|-------------|
| id | BIGINT (PK) | Identificador |
| name | VARCHAR(100) | Nombre del gimnasio |
| slug | VARCHAR(100) | Identificador Ãºnico para URLs |
| owner_id | BIGINT (FK users.id) | DueÃ±o del gimnasio |
| plan_id | BIGINT (FK plans.id) | Plan activo |
| status | ENUM('active','suspended') | Estado |
| created_at / updated_at | TIMESTAMP | AuditorÃ­a |

---

### ğŸ”¹ Tabla `plans
| Campo | Tipo | DescripciÃ³n |
|--------|------|-------------|
| id | BIGINT (PK) | Identificador |
| name | VARCHAR(50) | Nombre del plan |
| max_gyms | INT | LÃ­mite de gimnasios |
| max_members | INT | LÃ­mite de miembros |
| price | DECIMAL(10,2) | Precio mensual |
| created_at / updated_at | TIMESTAMP | AuditorÃ­a |

---

### ğŸ”¹ Tabla `memberships`

| Campo | Tipo | DescripciÃ³n |
|--------|------|-------------|
| id | BIGINT (PK) | Identificador |
| member_id | BIGINT (FK users.id) | Usuario con rol "member" |
| gym_id | BIGINT (FK gyms.id) | Gimnasio |
| type | VARCHAR(50) | Tipo de membresÃ­a (mensual, anual, etc.) |
| start_date | DATE | Fecha de inicio |
| end_date | DATE | Fecha de expiraciÃ³n |
| price | DECIMAL(10,2) | Costo |
| status | ENUM('active','expired','cancelled') | Estado |
| created_at / updated_at | TIMESTAMP | AuditorÃ­a |

---

### ğŸ”¹ Tabla `attendances`

| Campo | Tipo | DescripciÃ³n |
|--------|------|-------------|
| id | BIGINT (PK) | Identificador |
| member_id | BIGINT (FK users.id) | Miembro |
| gym_id | BIGINT (FK gyms.id) | Gimnasio |
| check_in | DATETIME | Entrada |
| check_out | DATETIME (nullable) | Salida |
| staff_id | BIGINT (FK users.id) | Staff que registrÃ³ la asistencia |

---

### ğŸ”¹ Tabla `backups`

| Campo | Tipo | DescripciÃ³n |
|--------|------|-------------|
| id | BIGINT (PK) | Identificador |
| gym_id | BIGINT (FK gyms.id) | Gimnasio asociado |
| file_path | VARCHAR(255) | Ruta del archivo de respaldo |
| created_by | BIGINT (FK users.id) | QuiÃ©n generÃ³ el respaldo |
| type | ENUM('auto','manual') | Tipo de backup |
| created_at | TIMESTAMP | Fecha del respaldo |

> âš™ï¸ Solo el **Admin SaaS** o el **DueÃ±o del Gimnasio** puede restaurar un backup.  
> Staff solo puede generarlos.

---

### ğŸ”¹ Tabla `staff_assignments`

| Campo | Tipo | DescripciÃ³n |
|--------|------|-------------|
| id | BIGINT (PK) | Identificador |
| staff_id | BIGINT (FK users.id) | Staff |
| gym_id | BIGINT (FK gyms.id) | Gimnasio asignado |
| position | VARCHAR(100) | Puesto o rol dentro del gym |
| active | BOOLEAN | Estado |
| created_at / updated_at | TIMESTAMP | AuditorÃ­a |

---

### ğŸ”¹ Tabla `fingerprints`

| Campo | Tipo | DescripciÃ³n |
|--------|------|-------------|
| id | BIGINT (PK) | Identificador |
| member_id | BIGINT (FK users.id) | Usuario (miembro) |
| fingerprint_code | VARCHAR(255) | CÃ³digo o hash generado por el lector local |
| registered_at | DATETIME | Fecha de registro de huella |
| active | BOOLEAN | Estado activo/inactivo |
| created_at / updated_at | TIMESTAMP | AuditorÃ­a |

> ğŸ§  Guarda solo el **hash o ID del dispositivo local**, no la imagen biomÃ©trica.

---

### ğŸ”¹ Tabla `gym_profiles`

| Campo | Tipo | DescripciÃ³n |
|--------|------|-------------|
| id | BIGINT (PK) | Identificador |
| gym_id | BIGINT (FK gyms.id) | Gimnasio |
| logo_url | VARCHAR(255) | Ruta o URL del logo |
| banner_url | VARCHAR(255) | Imagen opcional para portada |
| phone | VARCHAR(30) | TelÃ©fono |
| address | VARCHAR(255) | DirecciÃ³n |
| opening_hours | JSON | Horarios (por dÃ­a) |
| theme_color | VARCHAR(20) | Color principal (ej. `#FF0000`) |
| created_at / updated_at | TIMESTAMP | AuditorÃ­a |

---

### ğŸ”¹ Tabla `reports_cache`

| Campo | Tipo | DescripciÃ³n |
|--------|------|-------------|
| id | BIGINT (PK) | Identificador |
| gym_id | BIGINT (FK gyms.id) | Gimnasio |
| report_type | ENUM('memberships','attendances','backups') | Tipo de reporte |
| file_path | VARCHAR(255) | Ruta del archivo generado (.xlsx / .csv) |
| generated_by | BIGINT (FK users.id) | QuiÃ©n generÃ³ el reporte |
| generated_at | DATETIME | Fecha de creaciÃ³n |
| expires_at | DATETIME | Fecha en la que se elimina automÃ¡ticamente |

> ğŸ“Š Permite que los usuarios visualicen y descarguen reportes en formato Excel sin recargar el servidor.

---

### ğŸ•¸ï¸ Relaciones principales

Admin SaaS (user.role=admin)
        |
        +--> Gyms ---< Members (users.role=member)
                 \
                  +--> Staff (users.role=staff)
                  +--> Memberships
                  +--> Attendances
                  +--> Backups
                  +--> Gym Profiles
                  +--> Fingerprints
                  +--> Reports Cache

## ğŸ’¾ Paquetes disponibles

| Plan | CaracterÃ­sticas |
|------|-----------------|
| **Individual** | 1 gimnasio, hasta 50 miembros |
| **Pareja** | 2 gimnasios, hasta 120 miembros |
| **Estudiantes** | 1 gimnasio pequeÃ±o, hasta 30 miembros |

Todos incluyen backups automÃ¡ticos y manuales (solo restaurables por el dueÃ±o o admin).

---

## ğŸ”— Endpoints Principales (Resumen)

/api/
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ login
â”‚   â”œâ”€â”€ register
â”‚   â”œâ”€â”€ logout
â”‚   â””â”€â”€ refresh
â”œâ”€â”€ gyms/
â”‚   â”œâ”€â”€ create
â”‚   â”œâ”€â”€ list
â”‚   â””â”€â”€ suspend/{id}
â”œâ”€â”€ members/
â”‚   â”œâ”€â”€ create
â”‚   â”œâ”€â”€ update/{id}
â”‚   â””â”€â”€ checkin
â”œâ”€â”€ backups/
â”‚   â”œâ”€â”€ create
â”‚   â”œâ”€â”€ list
â”‚   â””â”€â”€ restore/{id}
â””â”€â”€ plans/
    â””â”€â”€ list


## ğŸ§° InstalaciÃ³n (local con Laravel)

git clone https://github.com/acltelematics/accesfy-backend.git
cd accesfy-backend
composer install
cp .env.example .env
php artisan key:generate
php artisan migrate --seed
php artisan serve


## ğŸŒ Infraestructura (Hetzner + Namecheap)

- **Namecheap:** Registro del dominio (ej. accesfy.com)  
- **Hetzner Cloud:** VPS Ubuntu 24.04 con stack LEMP  
- **Certbot (Let's Encrypt):** SSL automÃ¡tico  
- **Backups Hetzner:** Configurados diarios + locales (por gimnasio)

